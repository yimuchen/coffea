

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Installing coffea &mdash; coffea 0.7.0-rc.2 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Coffea by Example" href="examples.html" />
    <link rel="prev" title="coffea - Columnar Object Framework For Effective Analysis" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> coffea
          

          
          </a>

          
            
            
              <div class="version">
                0.7.0-rc
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installing coffea</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#platform-support">Platform support</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-coffea">Install coffea</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-optional-dependencies">Install optional dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-via-cvmfs">Install via cvmfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-portable-virtual-environment">Creating a portable virtual environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#for-developers">For Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Coffea by Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Coffea concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Reference Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">coffea</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Installing coffea</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="installing-coffea">
<span id="id1"></span><h1>Installing coffea<a class="headerlink" href="#installing-coffea" title="Permalink to this headline">¶</a></h1>
<div class="section" id="quick-start">
<h2>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>To try coffea now, without installing anything, you can experiment with our
<a class="reference external" href="https://mybinder.org/v2/gh/CoffeaTeam/coffea/master?filepath=binder/">hosted tutorial notebooks</a>.</p>
</div>
<div class="section" id="platform-support">
<h2>Platform support<a class="headerlink" href="#platform-support" title="Permalink to this headline">¶</a></h2>
<p>Coffea is a python package distributed via <a class="reference external" href="https://pypi.org/project/coffea">PyPI</a>. A python installation is required to use coffea.
Python version 3.6 or newer is required.</p>
<p>All functional features in each supported python version are routinely tested.
You can see the python version you have installed by typing the following at the command prompt:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">python</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>or, in some cases, if both python 2 and 3 are available, you can find the python 3 version via:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">python3</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>coffea core functionality is routinely tested on Windows, Linux and MacOS.
All <a class="reference internal" href="concepts.html#def-local-executors"><span class="std std-ref">Local executors</span></a> are tested against all three platforms,
however the <a class="reference internal" href="concepts.html#def-distributed-executors"><span class="std std-ref">Distributed executors</span></a> are not routinely tested on Windows.</p>
<p>Coffea starts from v0.5.0 in the PyPI repository since before v0.5.0 it was hosted as <a class="reference external" href="https://pypi.org/project/fnal-column-analysis-tools/">fnal-column-analysis-tools</a>. If you are still using fnal-column-analysis-tools, please move to <a class="reference external" href="https://pypi.org/project/coffea/">coffea</a>!</p>
</div>
<div class="section" id="install-coffea">
<h2>Install coffea<a class="headerlink" href="#install-coffea" title="Permalink to this headline">¶</a></h2>
<p>To install coffea, there are several mostly-equivalent options:</p>
<blockquote>
<div><ul class="simple">
<li><p>install coffea system-wide using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coffea</span></code>;</p></li>
<li><p>if you do not have administrator permissions, install as local user with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--user</span> <span class="pre">coffea</span></code>;</p></li>
<li><p>if you prefer to not place coffea in your global environment, you can set up a <a class="reference external" href="https://docs.python.org/3/library/venv.html">virtual environment</a>, and use the venv-provided pip;</p></li>
<li><p>if you use <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/index.html">Conda</a>,  simply activate the environment you wish to use and install via the conda-provided pip.</p></li>
<li><p>or, if you are using a machine that has cvmfs available, see <a class="reference internal" href="#install-via-cvmfs">Install via cvmfs</a> below.</p></li>
</ul>
</div></blockquote>
<p>To update a previously installed coffea to a newer version, use: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--upgrade</span> <span class="pre">coffea</span></code>
Although not required, it is recommended to also <a class="reference external" href="https://jupyter.org/install">install Jupyter</a>, as it provides a more interactive development environment.
The installation procedure is essentially identical as above: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">jupyter</span></code>. (If you use conda, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">jupyter</span></code> is a better option.)</p>
<p>In rare cases, you may find that the <code class="docutils literal notranslate"><span class="pre">pip</span></code> executable in your path does not correspond to the same python installation as the <code class="docutils literal notranslate"><span class="pre">python</span></code> executable. This is a sign of a broken python environment. However, this can be bypassed by using the syntax <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">...</span></code> in place of <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">...</span></code>.</p>
</div>
<div class="section" id="install-optional-dependencies">
<h2>Install optional dependencies<a class="headerlink" href="#install-optional-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Coffea supports several optional components that require additional package installations.
In particular, all of the <a class="reference internal" href="concepts.html#def-distributed-executors"><span class="std std-ref">Distributed executors</span></a> require additional packages.
The necessary dependencies can be installed easily via <code class="docutils literal notranslate"><span class="pre">pip</span></code> using the setuptools <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/setuptools.html#declaring-extras-optional-features-with-their-own-dependencies">extras</a>  facility:</p>
<blockquote>
<div><ul class="simple">
<li><p>Apache <a class="reference external" href="https://spark.apache.org/">Spark</a> distributed executor: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coffea[spark]</span></code></p></li>
<li><p><a class="reference external" href="http://parsl-project.org/">parsl</a> distributed executor: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coffea[parsl]</span></code></p></li>
<li><p><a class="reference external" href="https://distributed.dask.org/en/latest/">dask</a> distributed executor: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coffea[dask]</span></code></p></li>
<li><p><a class="reference external" href="https://cctools.readthedocs.io/en/latest/work_queue/">Work Queue</a> distributed executor: see <a class="reference internal" href="wq.html#intro-coffea-wq"><span class="std std-ref">Work Queue Executor</span></a> for installation instructions</p></li>
</ul>
</div></blockquote>
<p>Multiple extras can be installed together via, e.g. <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">coffea[dask,spark]</span></code></p>
</div>
<div class="section" id="install-via-cvmfs">
<h2>Install via cvmfs<a class="headerlink" href="#install-via-cvmfs" title="Permalink to this headline">¶</a></h2>
<p>Although the local installation can work anywhere, if the base environment does not already have most of the coffea dependencies, then the user-local package directory can become quite bloated.
An option to avoid this bloat is to use a base python environment provided via <a class="reference external" href="https://ep-dep-sft.web.cern.ch/document/lcg-releases">CERN LCG</a>, which is available on any system that has the <a class="reference external" href="https://cernvm.cern.ch/portal/filesystem">cvmfs</a> directory <code class="docutils literal notranslate"><span class="pre">/cvmfs/sft.cern.ch/</span></code> mounted.
Simply source a LCG release (shown here: 96python3) and install:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># check your platform: CC7 shown below, for SL6 it would be &quot;x86_64-slc6-gcc8-opt&quot;</span>
<span class="nb">source</span> /cvmfs/sft.cern.ch/lcg/views/LCG_96python3/x86_64-centos7-gcc8-opt/setup.sh  <span class="c1"># or .csh, etc.</span>
pip install --user coffea
</pre></div>
</div>
</div>
<div class="section" id="creating-a-portable-virtual-environment">
<h2>Creating a portable virtual environment<a class="headerlink" href="#creating-a-portable-virtual-environment" title="Permalink to this headline">¶</a></h2>
<p>In some instances, it may be useful to have a self-contained environment that can be relocated.
One use case is for users of coffea that do not have access to a distributed compute cluster that is compatible with
one of the coffea distributed executors. Here, a fallback solution can be found by creating traditional batch jobs (e.g. condor)
which then use coffea local executors, possibly multi-threaded. In this case, often the user-local python package directory
is not available from batch workers, so a portable python enviroment needs to be created.
Annoyingly, python virtual environments are not portable by default due to several hardcoded paths in specific locations,
however there are not many locations and some sed hacks can save the day.
Here is an example of a bash script that installs coffea on top of the LCG 98python3 software stack inside a portable virtual environment,
with the caveat that cvmfs must be visible from batch workers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="nv">NAME</span><span class="o">=</span>coffeaenv
<span class="nv">LCG</span><span class="o">=</span>/cvmfs/sft.cern.ch/lcg/views/LCG_98python3/x86_64-centos7-gcc9-opt

<span class="nb">source</span> <span class="nv">$LCG</span>/setup.sh
<span class="c1"># following https://aarongorka.com/blog/portable-virtualenv/, an alternative is https://github.com/pantsbuild/pex</span>
python -m venv --copies <span class="nv">$NAME</span>
<span class="nb">source</span> <span class="nv">$NAME</span>/bin/activate
<span class="nv">LOCALPATH</span><span class="o">=</span><span class="k">$(</span>python -c <span class="s1">&#39;import sys; print(f&quot;{sys.prefix}/lib/python{sys.version_info.major}.{sys.version_info.minor}/site-packages&quot;)&#39;</span><span class="k">)</span>
<span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="si">${</span><span class="nv">LOCALPATH</span><span class="si">}</span>:<span class="nv">$PYTHONPATH</span>
python -m pip install setuptools pip wheel --upgrade
python -m pip install coffea
sed -i <span class="s1">&#39;1s/#!.*python$/#!\/usr\/bin\/env python/&#39;</span> <span class="nv">$NAME</span>/bin/*
sed -i <span class="s1">&#39;40s/.*/VIRTUAL_ENV=&quot;$(cd &quot;$(dirname &quot;$(dirname &quot;${BASH_SOURCE[0]}&quot; )&quot;)&quot; \&amp;\&amp; pwd)&quot;/&#39;</span> <span class="nv">$NAME</span>/bin/activate
sed -i <span class="s2">&quot;2a source </span><span class="si">${</span><span class="nv">LCG</span><span class="si">}</span><span class="s2">/setup.sh&quot;</span> <span class="nv">$NAME</span>/bin/activate
sed -i <span class="s2">&quot;3a export PYTHONPATH=</span><span class="si">${</span><span class="nv">LOCALPATH</span><span class="si">}</span><span class="s2">:\$PYTHONPATH&quot;</span> <span class="nv">$NAME</span>/bin/activate
tar -zcf <span class="si">${</span><span class="nv">NAME</span><span class="si">}</span>.tar.gz <span class="si">${</span><span class="nv">NAME</span><span class="si">}</span>
</pre></div>
</div>
<p>The resulting tarball size is about 60 MB.
An example batch job wrapper script is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
tar -zxf coffeaenv.tar.gz
<span class="nb">source</span> coffeaenv/bin/activate

<span class="nb">echo</span> <span class="s2">&quot;Running command:&quot;</span> <span class="nv">$@</span>
<span class="nb">time</span> <span class="nv">$@</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
</pre></div>
</div>
<p>Unless you install jupyter into this environment (which may bloat the tarball–LCG98 jupyter is reasonably recent), it is not visible inside the LCG jupyter server. From a shell with the virtual environment activated, you can execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">ipykernel</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">coffeaenv</span>
</pre></div>
</div>
<p>to make a new kernel available that uses this environment.</p>
</div>
<div class="section" id="for-developers">
<h2>For Developers<a class="headerlink" href="#for-developers" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Download source:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/CoffeaTeam/coffea
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Install with development dependencies:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> coffea
pip install --editable .<span class="o">[</span>dev<span class="o">]</span>
// or <span class="k">if</span> you need to work on the executors, e.g. dask,
pip install --editable .<span class="o">[</span>dev,dask<span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Develop a cool new feature or fix some bugs</p></li>
<li><p>Lint source, run tests, and build documentation:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flake8 coffea
pytest tests
<span class="nb">pushd</span> docs <span class="o">&amp;&amp;</span> make html <span class="o">&amp;&amp;</span> <span class="nb">popd</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Make a pull request!</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="examples.html" class="btn btn-neutral float-right" title="Coffea by Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="coffea - Columnar Object Framework For Effective Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, Fermi National Accelerator Laboratory.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>